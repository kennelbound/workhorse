/*! workhorse v1.0.0 - 2014-11-21 
 *  License: MIT */
workhorse=function(){var a=function(a,b){return a.exports=b,function(){var b=!1,c=/xyz/.test(function(){})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(a){function d(){!b&&this.init&&this.init.apply(this,arguments)}var e=this.prototype;b=!0;var f=new this;b=!1;for(var g in a)f[g]="function"==typeof a[g]&&"function"==typeof e[g]&&c.test(a[g])?function(a,b){return function(){var c=this._super;this._super=e[a];var d=b.apply(this,arguments);return this._super=c,d}}(g,a[g]):a[g];return d.prototype=f,d.prototype.constructor=d,d.extend=arguments.callee,d},a.exports=Class}(),a.exports}({},{}),b=function(a,b){return a.exports=b,function(){function b(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=k[a])});16>e;)b[d+e++]=0;return b}function c(a,b){var c=b||0,d=j;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function d(a,b,d){var e=b&&d||0,f=b||[];a=a||{};var g=null!==a.clockseq?a.clockseq:o,h=null!==a.msecs?a.msecs:(new Date).getTime(),i=null!==a.nsecs?a.nsecs:q+1,j=h-p+(i-q)/1e4;if(0>j&&null===a.clockseq&&(g=g+1&16383),(0>j||h>p)&&null===a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=h,q=i,o=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[e++]=k>>>24&255,f[e++]=k>>>16&255,f[e++]=k>>>8&255,f[e++]=255&k;var l=h/4294967296*1e4&268435455;f[e++]=l>>>8&255,f[e++]=255&l,f[e++]=l>>>24&15|16,f[e++]=l>>>16&255,f[e++]=g>>>8|128,f[e++]=255&g;for(var m=a.node||n,r=0;6>r;r++)f[e+r]=m[r];return b?b:c(f)}function e(a,b,d){var e=b&&d||0;"string"==typeof a&&(b="binary"==a?new i(16):null,a=null),a=a||{};var g=a.random||(a.rng||f)();if(g[6]=15&g[6]|64,g[8]=63&g[8]|128,b)for(var h=0;16>h;h++)b[e+h]=g[h];return b||c(g)}var f,g=this;if(!f){var h=new Array(16);f=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),h[b]=a>>>((3&b)<<3)&255;return h}}for(var i="function"==typeof Buffer?Buffer:Array,j=[],k={},l=0;256>l;l++)j[l]=(l+256).toString(16).substr(1),k[j[l]]=l;var m=f(),n=[1|m[0],m[1],m[2],m[3],m[4],m[5]],o=16383&(m[6]<<8|m[7]),p=0,q=0,r=e;if(r.v1=d,r.v4=e,r.parse=b,r.unparse=c,r.BufferClass=i,"function"==typeof define&&define.amd)define(function(){return r});else if("undefined"!=typeof a&&a.exports)a.exports=r;else{var s=g.uuid;r.noConflict=function(){return g.uuid=s,r},g.uuid=r}}.call(this),a.exports}({},{}),c=function(a,b){a.exports=b;var c={deserializationMethodRegistry:{},deserialize:function(a){if(!a)return a;var b=a._classname,d=c.deserializationMethodRegistry[b];return d?d(a):(console.log("Cannot find serializer registry for",b),a)},serialize:function(a){return a&&a.hasOwnProperty("toJSONObject")&&a.hasOwnProperty("_classname")?a.toJSONObject():a},registerClass:function(a,b){c.deserializationMethodRegistry[a]=b}};return a.exports=c,a.exports}({},{}),d=function(d,e){d.exports=e;var f=a,g=b,h=c,i=f.extend({_classname:"BaseClass",_serializedJSON:null,name:null,uuid:null,init:function(){this.uuid=g.v4()},getJSONProperty:function(){for(var a={},b=0;b<arguments.length;b++){var c=arguments[b],d=this[c];if(d instanceof Array)a[c]=d.length>0&&d[0]instanceof i?d.map(function(a){return a.toJSONObject()}):d.slice();else if(d instanceof i)a[c]=d.toJSONObject();else if(d instanceof Object){var e={};for(var f in d)e[f]=d[f];a[c]=e}else a[c]=d}return a},toJSONObject:function(){var a=this.getJSONProperty("name","uuid");return a._classname=this._classname,a},clone:function(){return h.deserialize(this.toJSONObject())},_extend:function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]},_rehydrate:function(a){var b=this;for(var c in a)if("_"!=c.substring(0,1)){var d=b[c]=a[c];if(d)if(d.hasOwnProperty("_classname"))b[c]=h.deserialize(d);else if(d instanceof Array)if(d.length>0&&d[0].hasOwnProperty("_classname"))for(var e=0;e<d.length;e++)d[e]=h.deserialize(d[e]);else b[c]=d.slice()}}});return d.exports=i,d.exports}({},{}),e=function(a,b){a.exports=b;var e=d,f=c,g=e.extend({_classname:"WorkerMessage",type:null,workerId:null,content:null,init:function(a,b,c){this._super(),this.type=a,this.content=b,this.workerId=c,this.content&&this.content instanceof e&&(this.content=this.content.toJSONObject())},toJSONObject:function(){return this._extend(this._super(),this.getJSONProperty("type","content","workerId"))}});return g.MESSAGE_TYPE_START="start",g.MESSAGE_TYPE_STOP="stop",g.MESSAGE_TYPE_PAUSE="pause",g.MESSAGE_TYPE_RESUME="resume",g.MESSAGE_TYPE_INIT="init",g.MESSAGE_TYPE_UPDATE="update",g.MESSAGE_TYPE_FINISHED="finished",g.MESSAGE_TYPE_ERROR="error",g.deserialize=function(a){return new g(a.type,a.content,a.workerId)},f.registerClass(g.prototype._classname,g.deserialize),a.exports=g,a.exports}({},{}),f=function(b,d){b.exports=d;var f=a,g=c,h=e,i=f.extend({workers:null,defaultMessageHandler:null,updateMessageHandler:null,errorMessageHandler:null,finishedMessageHandler:null,init:function(a,b,c,d){this.workers={},this.updateMessageHandler=a,this.finishedMessageHandler=b,this.errorMessageHandler=c,this.defaultMessageHandler=d},handleIncomingMessage:function(a){console.log(a);var b=g.deserialize(a.data);switch(b.type){case h.MESSAGE_TYPE_INIT:var c=a.target,d=a.data.workerId;this.workers[d]=c,null!==this.workers[c]&&(this.workers[c](d),delete this.workers[c]);break;case h.MESSAGE_TYPE_ERROR:this.errorMessageHandler&&this.errorMessageHandler(b);break;case h.MESSAGE_TYPE_FINISHED:this.finishedMessageHandler&&this.finishedMessageHandler(b);break;case h.MESSAGE_TYPE_UPDATE:this.updateMessageHandler&&this.updateMessageHandler(b);break;default:this.defaultMessageHandler&&this.defaultMessageHandler(b)}},initWorker:function(a,b){var c=this,d=new Worker(a);d.addEventListener("message",function(a){c.handleIncomingMessage(a)},!1),this.workers[d]=b},sendMessage:function(a,b,c){var d=new h(b,c).toJSONObject();this.workers[a].postMessage(d)},start:function(a,b){this.sendMessage(a,h.MESSAGE_TYPE_START,b)},pause:function(a){this.sendMessage(a,h.MESSAGE_TYPE_PAUSE)},resume:function(a){this.sendMessage(a,h.MESSAGE_TYPE_RESUME)},stop:function(a){this.sendMessage(a,h.MESSAGE_TYPE_STOP)}});return b.exports=i,b.exports}({},{}),g=function(d,f){d.exports=f;var g=a,h=c,i=e,j=b,k=g.extend({started:!1,paused:!1,cycle:0,sendOnCyle:0,uuid:null,initialDataHandler:null,defaultMessageHandler:null,createUpdateContentHandler:null,executeHandler:null,init:function(a,b,c,d){this.uuid=j.v4(),this.executeHandler=a,this.initialDataHandler=b,this.createUpdateContentHandler=c,this.defaultMessageHandler=d,this.sendMessage(i.MESSAGE_TYPE_INIT)},handleIncomingMessage:function(a){console.log("Received message from main thread",a);var b=h.deserialize(a);switch(b.type){case i.MESSAGE_TYPE_START:this.start(h.deserialize(a.content));break;case i.MESSAGE_TYPE_PAUSE:this.pause();break;case i.MESSAGE_TYPE_STOP:this.stop();break;case i.MESSAGE_TYPE_RESUME:this.resume();break;default:this.defaultMessageHandler&&this.defaultMessageHandler(b)}},listen:function(){var a=this;onmessage=function(b){a.handleIncomingMessage(b.data)}},start:function(a){this.currentSimulation=a,this.lastEventDateTimeMS=(new Date).getTime(),this.started=!0,this.paused=!1,this.initialDataHandler(a),this.run()},run:function(){for(;this.started;)this.execute()},execute:function(){this.started&&!this.paused&&(this.executeHandler&&this.executeHandler(),this.cycle++,null!==this.sendOnCycle&&this.cycle%this.sendOnCyle===0&&this.update())},error:function(a){this.sendMessage(i.MESSAGE_TYPE_ERROR,a),this.stop()},finished:function(a){this.sendMessage(i.MESSAGE_TYPE_FINISHED,a),this.stop()},update:function(){var a=null;this.createUpdateContentHandler&&(a=this.createUpdateContentHandler()),this.sendMessage(i.MESSAGE_TYPE_UPDATE,a)},stop:function(){this.started=!1},pause:function(){this.paused=!0},resume:function(){this.paused=!1},sendMessage:function(a,b){var c=new i(a,b,this.uuid).toJSONObject();postMessage(c)}});return d.exports=k,d.exports}({},{}),h=function(a,b){return a.exports=b,b.Serializer=c,b.BaseClass=d,b.WorkerMessage=e,b.Harness=f,b.Plow=g,a.exports}({},{});return h}();